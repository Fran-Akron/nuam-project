{% extends "nuapp/base.html" %}
{% block content %}

<div class="max-w-3xl mx-auto">

  <!-- HEADER -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-extrabold text-slate-900">
        {% if calificacion %}
          Editar <span class="text-orange-500">Calificación</span>
        {% else %}
          Nueva <span class="text-orange-500">Calificación</span>
        {% endif %}
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {% if calificacion %}
          Modifica los datos de la calificación.
        {% else %}
          Registra una calificación asociada a un instrumento financiero.
        {% endif %}
      </p>
    </div>

    <a href="{% url 'calificaciones' %}"
       class="text-sm font-semibold text-slate-600 hover:text-slate-900">
      ← Volver
    </a>
  </div>

  <!-- FORM -->
  <div class="bg-white border border-slate-200 rounded-2xl shadow-sm p-6">

    <form method="post" class="grid grid-cols-1 gap-5">
      {% csrf_token %}

      <!-- Instrumento -->
      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Instrumento
        </label>
        <select name="instrumento" required
          class="w-full rounded-xl border px-3 py-2 text-sm bg-white">
          <option value="">Selecciona un instrumento</option>
          {% for instrumento in instrumentos %}
            <option value="{{ instrumento.id }}"
              {% if calificacion and calificacion.instrumento.id == instrumento.id %}selected{% endif %}>
              {{ instrumento.codigo }} – {{ instrumento.nombre }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Tipo -->
      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Tipo de calificación
        </label>
        <select name="tipo" required
          class="w-full rounded-xl border px-3 py-2 text-sm bg-white">
          {% for key, label in tipos %}
            <option value="{{ key }}"
              {% if calificacion and calificacion.tipo == key %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Monto -->
      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Monto
        </label>
        <input type="number" step="0.01" name="monto"
          value="{% if calificacion and calificacion.monto != None %}{{ calificacion.monto }}{% endif %}"
          class="w-full rounded-xl border px-3 py-2 text-sm"
          placeholder="Ej: 1000000">
      </div>

      <!-- Fecha -->
      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Fecha
        </label>
        <input type="date" name="fecha" required
          value="{% if calificacion %}{{ calificacion.fecha|date:'Y-m-d' }}{% endif %}"
          class="w-full rounded-xl border px-3 py-2 text-sm">
      </div>

      <!-- Estado -->
      <div>
        <label class="block text-xs font-semibold text-slate-500 mb-1">
          Estado
        </label>
        <select name="estado"
          class="w-full rounded-xl border px-3 py-2 text-sm bg-white">
          {% for key, label in estados %}
            <option value="{{ key }}"
              {% if calificacion and calificacion.estado == key %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- BOTONES -->
      <div class="flex justify-end gap-3 pt-4">
        <a href="{% url 'calificaciones' %}"
           class="rounded-xl px-4 py-2 text-sm border">
          Cancelar
        </a>

        <button type="submit"
          class="rounded-xl px-5 py-2 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600">
          {% if calificacion %}
            Guardar cambios
          {% else %}
            Guardar calificación
          {% endif %}
        </button>
      </div>

    </form>

  </div>

</div>

{% endblock %}
