{% extends "base.html" %}
{% with active_page="dashboard" %}
{% block title %}Dashboard - NUAM{% endblock %}

{% block content %}

<h2 class="text-3xl font-bold mb-2 text-slate-900">
    Dashboard Consolidado NUAM
</h2>

<p class="text-slate-600 mb-1">
    Visualización resumida del comportamiento semanal de los principales mercados.
</p>

<p class="text-slate-500 text-sm mb-6">
    Datos actualizados al: {{ updated_at }}
</p>

<!-- =========================
     TARJETAS SUPERIORES
========================= -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">

    <!-- CHILE -->
    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
        <div class="text-sm text-slate-500 uppercase">Chile (IPSA)</div>
        <div class="text-3xl font-extrabold text-slate-900 mt-1">
            {{ valor_chile|default:"Sin datos" }}
            {% if trend_chile == "up" %}
                <span class="text-green-600 text-xl">▲</span>
            {% elif trend_chile == "down" %}
                <span class="text-red-600 text-xl">▼</span>
            {% endif %}
        </div>
        <div class="text-xs text-slate-500">Variación diaria</div>
    </div>

    <!-- COLOMBIA -->
    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
        <div class="text-sm text-slate-500 uppercase">Colombia (EWC)</div>
        <div class="text-3xl font-extrabold text-slate-900 mt-1">
            {{ valor_colombia }}
            {% if trend_colombia == "up" %}
                <span class="text-green-600 text-xl">▲</span>
            {% elif trend_colombia == "down" %}
                <span class="text-red-600 text-xl">▼</span>
            {% endif %}
        </div>
        <div class="text-xs text-slate-500">Variación diaria</div>
    </div>

    <!-- PERÚ -->
    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
        <div class="text-sm text-slate-500 uppercase">Perú (EPU)</div>
        <div class="text-3xl font-extrabold text-slate-900 mt-1">
            {{ valor_peru }}
            {% if trend_peru == "up" %}
                <span class="text-green-600 text-xl">▲</span>
            {% elif trend_peru == "down" %}
                <span class="text-red-600 text-xl">▼</span>
            {% endif %}
        </div>
        <div class="text-xs text-slate-500">Variación diaria</div>
    </div>

    <!-- USD -->
    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
        <div class="text-sm text-slate-500 uppercase">USD / CLP</div>
        <div class="text-3xl font-extrabold text-slate-900 mt-1">
            {{ usd_clp }}
        </div>
        <div class="text-xs text-slate-500">Tipo de cambio</div>
    </div>

</div>

<!-- =========================
     GRÁFICOS
========================= -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">

    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm h-72">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">Santiago (IPSA)</h3>
        <canvas id="chartIpsa"></canvas>
    </div>

    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm h-72">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">Colombia (EWC)</h3>
        <canvas id="chartColombia"></canvas>
    </div>

    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm h-72">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">Perú (EPU)</h3>
        <canvas id="chartPeru"></canvas>
    </div>

</div>

<footer class="mt-10 text-center text-sm text-slate-500 border-t border-slate-200 pt-4">
    Plataforma NUAM – Dashboard Consolidado.
</footer>

<!-- =========================
     CHART.JS
========================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
function crearGrafico(id, labels, data) {
    const ctx = document.getElementById(id);
    if (!ctx || !labels || labels.length === 0) return;

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                borderColor: '#F97316',
                backgroundColor: 'transparent',
                tension: 0.3,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    ticks: { color: '#64748B' },
                    grid: { color: '#E5E7EB' }
                },
                y: {
                    ticks: { color: '#64748B' },
                    grid: { color: '#E5E7EB' }
                }
            }
        }
    });
}

crearGrafico("chartIpsa", {{ fechas_chile|safe }}, {{ hist_chile|safe }});
crearGrafico("chartColombia", {{ fechas_col|safe }}, {{ hist_col|safe }});
crearGrafico("chartPeru", {{ fechas_per|safe }}, {{ hist_per|safe }});
</script>

{% endblock %}
{% endwith %}
